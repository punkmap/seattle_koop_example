(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{202:function(e,t,a){e.exports=a.p+"static/media/PushPin.d22b5a3d.png"},218:function(e,t,a){e.exports=a(515)},242:function(e,t,a){},243:function(e,t){var a={salesforce:{}};a.salesforce.client_id="3MVG9PbQtiUzNgN6qyCRXekPUMS7LDgAd4wRM2RGE.7F8tce_sPY5k8cAnOsw0xOmk4NIIO4RhxVYbs.yeW5G",a.salesforce.client_secret="E954C9C5E1949CF61A3254EBB4E1C3474CC972D52CF25B39EE209E3003788CC5",a.salesforce.sandboxRoot="https://carync--zeus.cs51.my.salesforce.com/",a.salesforce.callbackRoot="http://woesoflightning.com",e.exports=a},246:function(e,t,a){},410:function(e,t,a){},501:function(e,t,a){},512:function(e,t,a){},513:function(e,t,a){},514:function(e,t,a){},515:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(17),i=a.n(o),s=a(19),l=a(20),c=a(22),u=a(21),p=a(23),d=a(32),m=a.n(d),h=(a(242),a(243),a(48)),g=a(6),f=a(201),y=a(37),b=(a(246),a(202)),E=a.n(b),v=a(15),I=a.n(v),C=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={searchWidget:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){var e=this;Object(y.loadModules)(["esri/widgets/Search","esri/layers/GraphicsLayer","esri/Graphic","esri/symbols/PictureMarkerSymbol","esri/geometry/support/webMercatorUtils","esri/tasks/Locator"]).then(function(t){var a=Object(h.a)(t,6),n=a[0],r=a[1],o=a[2],i=a[3],s=a[4],l=a[5];if(null==e.state.searchWidget&&null!=e.props.view&&null!=e.props.view.map){var c=e.props.view,u=new n({view:c,container:"searchWidget",locationEnabled:!1,resultGraphicEnabled:!1}),p=u.get("sources");p.push({featureLayer:{url:"https://maps.townofcary.org/arcgis1/rest/services/Property/Property/MapServer/0"},searchFields:["PIN10"],displayField:"PIN10",exactMatch:!1,outFields:["PIN10"],name:"Property PIN10",placeholder:"PIN10: 0764523393"},{locator:new l("https://maps.townofcary.org/arcgis1/rest/services/Locators/Cary_Com_Locator/GeocodeServer"),singleLineFieldName:"SingleLine",outFields:["*"],name:"ToC Locator",autoNavigate:!0,maxSuggestions:3,placeholder:"Address: 120 Wilkinson Ave"}),u.set("sources",p),u.activeSourceIndex=1,e.setState({searchWidget:u});var d=new r;e.props.view.map.add(d,5);var m,g,f=new i({url:E.a,height:"48px",width:"48px"});if(u.on("search-complete",function(e){var t=s.webMercatorToGeographic(e.results[0].results[0].feature.geometry),a=new o({geometry:t,symbol:f});console.log("event.activeSourceIndex: "+e.activeSourceIndex),d.graphics.add(a)}),1==e.props.resultPinDragable)c.on("drag",function(e){if("start"===e.action)c.hitTest(e).then(function(t){t.results[0].graphic&&"point"===t.results[0].graphic.geometry.type&&(e.stopPropagation(),m=t.results[0].graphic)});else if("update"===e.action)m&&(e.stopPropagation(),g?d.remove(g):d.remove(m),(g=m.clone()).geometry=c.toMap(e),d.add(g));else if("end"===e.action&&m){e.stopPropagation(),g&&d.remove(g);var t=m.clone();t.geometry=g.geometry.clone(),d.add(t),m=null,g=null}})}})}},{key:"render",value:function(){return r.a.createElement("div",{className:"mapSearch"},r.a.createElement(I.a,{container:!0,spacing:16,alignItems:"center",direction:"row",justify:"center"},r.a.createElement("div",{id:"searchWidget"})))}}]),t}(n.Component),O=a(38),S=a(5),j=a.n(S),x=a(7),k=a.n(x),w=a(204),D=a.n(w),A=a(205),T=a.n(A),N=a(129),F=a.n(N),P=a(130),B=a.n(P),L=a(208),R=a.n(L),_=a(131),M=a.n(_),U=a(207),V=a.n(U),J=a(210),G=a.n(J),q=a(209),Y=a.n(q),W=a(46),z=a.n(W),Q=a(73),H=a.n(Q),K=a(45),X=a.n(K),$=a(206),Z=a.n($),ee=a(53),te=a.n(ee),ae=a(52),ne=a.n(ae),re=a(88),oe=a.n(re),ie=a(47),se=a.n(ie);a(410);var le=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).update=function(e){a.props.onUpdate(e.target.value),a.setState({fieldVal:e.target.value})},a.handleChange=function(e){return function(t){"project"===e||"project_delete"===e?a.props.projectCallback(t.target.value):a.props.phaseCallback(t.target.value),a.setState(Object(O.a)({},e,t.target.value),function(){console.log("this.state.project_delete: "+a.state.project_delete),console.log("this.state.phase_delete: "+a.state.phase_delete),a.state.project&&a.state.phase?a.setState({disableAddButton:!1}):a.setState({disableAddButton:!0}),a.state.project_delete&&a.state.phase_delete?a.setState({disableDeleteButton:!1}):a.setState({disableDeleteButton:!0})})}},a.menuClick=function(e){a.setState({anchorEl:e.currentTarget})},a.handleClose=function(e){return function(t){"add"===e?a.setState({titleBarTitle:"Add Project"}):a.setState({titleBarTitle:"Remove Project"}),a.setState({editAction:e}),a.setState({anchorEl:null})}},a.getPointerEvents=function(){return!0},a.componentDidMount=function(){a.sideNav=r.a.createRef()},a.addProject=function(){a.setState({project:""}),a.setState({phase:""}),a.setState({disableAddButton:!0}),a.props.addSelectedProperties()},a.removeProject=function(){a.setState({project_delete:""}),a.setState({phase_delete:""}),a.setState({disableDeleteButton:!0}),a.props.deleteSelectedProperties()};a.props.classes;return a.state={project:"",phase:"",project_delete:"",phase_delete:"",disableAddButton:!0,showDeleteButton:!0,anchorEl:null,editAction:"add",titleBarTitle:"Add Project",pointerEvents:"auto"},a.menuClick=a.menuClick.bind(Object(g.a)(Object(g.a)(a))),a.handleClose=a.handleClose.bind(Object(g.a)(Object(g.a)(a))),a.sideNav=r.a.createRef(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this.props.classes;return r.a.createElement(T.a,{muiTheme:F()(D.a)},r.a.createElement("div",null,r.a.createElement(te.a,{in:!this.props.hideSidePanel,timeout:1e3},r.a.createElement(ne.a,{className:j()("sidePanel",Object(O.a)({},e.pointerEventsAuto,!1===this.props.hideSidePanel))},r.a.createElement(Z.a,{className:e.appBar,title:this.state.titleBarTitle,iconElementLeft:r.a.createElement(B.a,{color:"inherit","aria-label":"Menu","aria-owns":this.state.anchorEl?"simple-menu":void 0,"aria-haspopup":"true",onClick:this.menuClick},r.a.createElement(V.a,null))},r.a.createElement(R.a,{id:"simple-menu",anchorEl:this.state.anchorEl,open:Boolean(this.state.anchorEl),onChange:this.handleClose},r.a.createElement(M.a,{onClick:this.handleClose("add")},"Add"),r.a.createElement(M.a,{onClick:this.handleClose("remove")},"Remove"))),"add"===this.state.editAction?r.a.createElement(oe.a,{margin:"normal"},r.a.createElement(se.a,{id:"tf_project",label:"Project Number",className:e.TextField,value:this.state.project,onChange:this.handleChange("project"),margin:"normal",variant:"outlined"}),r.a.createElement(se.a,{id:"tf_phase",label:"Phase",className:e.TextField,value:this.state.phase,onChange:this.handleChange("phase"),margin:"normal",variant:"outlined"}),r.a.createElement(X.a,{variant:"extended",disabled:this.state.disableAddButton,color:"primary","aria-label":"Add",className:e.addButton,onClick:this.addProject},r.a.createElement(Y.a,{className:e.extendedIcon}),r.a.createElement("b",null,"Add Selection"))):r.a.createElement(oe.a,{margin:"normal"},r.a.createElement(se.a,{id:"tf_project_delete",label:"Project Number",className:e.textField,value:this.state.project_delete,onChange:this.handleChange("project_delete"),margin:"normal",variant:"outlined"}),r.a.createElement(se.a,{id:"tf_phase_delete",label:"Phase",className:e.textField,value:this.state.phase_delete,onChange:this.handleChange("phase_delete"),margin:"normal",variant:"outlined"}),r.a.createElement(X.a,{variant:"extended",disabled:this.state.disableDeleteButton,color:"primary","aria-label":"Delete",className:e.deleteButton,onClick:this.removeProject},r.a.createElement(G.a,{className:e.extendedIcon}),r.a.createElement("b",null,"Delete Project")))))))}}]),t}(n.Component),ce=(k()(function(e){return{appBar:{position:"relative"},textField:{marginLeft:e.spacing.unit,marginRight:e.spacing.unit},pointerEventsAuto:{pointerEvents:"auto"},paper:{paddingTop:2*e.spacing.unit,paddingBottom:2*e.spacing.unit},type:{width:"100%",maxWidth:500,paddingLeft:15},typeTitle:{paddingTop:5},addButton:{color:e.palette.getContrastText(z.a[500]),backgroundColor:z.a[500],"&:hover":{backgroundColor:z.a[700]}},deleteButton:{color:e.palette.getContrastText(H.a[500]),backgroundColor:H.a[500],"&:hover":{backgroundColor:H.a[700]}},extendedIcon:{marginRight:2*e.spacing.unit}}})(le),a(132)),ue=a(72),pe=a(65),de=a.n(pe),me=a(211),he=a.n(me),ge=a(212),fe=a.n(ge),ye=a(89),be=a.n(ye),Ee=a(90),ve=a.n(Ee),Ie=a(74),Ce=a.n(Ie),Oe=a(64),Se=a.n(Oe),je=a(92),xe=a.n(je),ke=a(91),we=a.n(ke),De=a(134),Ae=a.n(De),Te=a(213),Ne=a.n(Te),Fe=a(214),Pe=a.n(Fe),Be=a(216),Le=a.n(Be),Re=a(87),_e=a.n(Re),Me=a(215),Ue=a.n(Me),Ve=a(133),Je=a.n(Ve),Ge=(a(501),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).toggleAdopt=function(){var e=Object(g.a)(Object(g.a)(a)),t=e.getAdoptStatusByIndex(e.state.pageIndex),n={sfid:t.value["Salesforce Id"],Adopted:!t.value.Adopted};m()({method:"post",url:a.props.nodeAppRoot+"toggleadopt/",data:{info:n}}).then(function(t){var a=JSON.parse(JSON.stringify(e.state.adoptData));e.getAdoptStatusByIndex(e.state.pageIndex).value.Adopted=!e.getAdoptStatusByIndex(e.state.pageIndex).value.Adopted,e.setState({adoptData:a}),e.props.adoptCallback(e.getAdoptStatusByIndex(e.state.pageIndex))}).catch(function(e){console.log("login ELSE error: "+e)})},a.getChatterFeed=function(){var e=Object(g.a)(Object(g.a)(a)),t=e.getAdoptStatusByIndex(e.state.pageIndex).value["Salesforce Id"];m()({method:"post",url:a.props.nodeAppRoot+"getchatterfeed/",data:{sfId:t}}).then(function(t){e.state.chatterInfo!==t.data&&(e.setState({chatterInfo:t.data}),e.props.panelUseChangeCallback("chatter"))}).catch(function(e){console.log("login ELSE error: "+e)})},a.constructChatterDiv=function(e){e.forEach(function(e){e.hasOwnProperty("htmlTag")?"MarkupBegin"===e.type?"<"+e.htmlTag+">":"</"+e.htmlTag+">":e.hasOwnProperty("text")&&e.text})},a.addPost=function(e){var t=Object(g.a)(Object(g.a)(a)),n={body:{messageSegments:[{type:"Text",text:a.state.postText}]},feedElementType:"FeedItem",subjectId:e};m()({method:"post",url:a.props.nodeAppRoot+"addchatterpost/",data:{msgBody:n}}).then(function(e){var a=t.state.chatterInfo;a.unshift(e.data),t.setState({chatterInfo:a}),t.setState({postText:""})}).catch(function(e){console.log("login ELSE error: "+e)})},a.postOnChange=function(e){a.setState({postText:e.target.value})},a.addComment=function(e){var t=Object(g.a)(Object(g.a)(a)),n={messageId:e,comment:a.state.commentValues[e]};m()({method:"post",url:a.props.nodeAppRoot+"addchattercomment/",data:{msgBody:n}}).then(function(a){for(var n=t.state.chatterInfo,r=0;r<n.length;r++){if(n[r].message.id===e){n[r].message.comments.page.items.push(a.data),t.setState({chatterInfo:n}),t.setState({commentValues:Object(ce.a)({},t.state.commentValues,Object(O.a)({},e,""))});break}}}).catch(function(e){console.log("login ELSE error: "+e)})},a.nextRecord=function(){a.setState({pageIndex:a.state.pageIndex+1})},a.lastRecord=function(){a.setState({pageIndex:a.state.pageIndex-1})},a.getAdoptStatusByIndex=function(e){var t=Object.keys(a.state.adoptData)[e];return{key:t,value:a.state.adoptData[t]}},a.isSalesforceLink=function(e){return console.log(e),"Salesforce Id"===e},a.state={pageIndex:0,pageCount:null,popupData:null,hasError:!1,adoptData:{value:{adopted:null,label:null}},chatterInfo:null,postText:"",commentValues:[],panelUse:null,chatterFeedInterval:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(){var e=this;e.props.infoData&&this.state.adoptData!==this.props.infoData&&e.setState({adoptData:e.props.infoData}),this.props.panelUse!==this.state.panelUse&&(this.setState({panelUse:this.props.panelUse}),"chatter"===this.props.panelUse?this.setState({chatterFeedInterval:setInterval(function(){e.getChatterFeed()},3e4)}):clearInterval(this.state.chatterFeedInterval))}},{key:"commentOnChange",value:function(e,t){this.setState({commentValues:Object(ce.a)({},this.state.commentValues,Object(O.a)({},e,t.target.value))})}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this;return r.a.createElement(te.a,{in:null!=this.props.infoData,timeout:1},r.a.createElement("div",{className:j()("infoPanel",Object(O.a)({},t.pointerEventsAuto,null!=this.props.infoData))},"info"===this.props.panelUse&&r.a.createElement(te.a,{in:"info"===this.props.panelUse,timeout:1},r.a.createElement("div",null,r.a.createElement("div",{className:"header"},r.a.createElement(I.a,{container:!0,spacing:16,alignItems:"center",direction:"row",justify:"center"},r.a.createElement(I.a,{item:!0,xs:!0},r.a.createElement(de.a,{disabled:!0,className:t.button,onClick:this.lastRecord},r.a.createElement(he.a,null))),r.a.createElement(I.a,{item:!0,xs:6},a.props.infoData?r.a.createElement("h4",null,"Facility Id: ",JSON.stringify(a.getAdoptStatusByIndex(a.state.pageIndex).value["Facility ID"])):null),r.a.createElement(I.a,{item:!0,xs:!0},r.a.createElement(de.a,{disabled:!0,className:t.button,onClick:this.nextRecord},r.a.createElement(fe.a,null))))),r.a.createElement("div",{className:"body"},r.a.createElement(I.a,{container:!0,direction:"column",justify:"center",alignItems:"center"},a.props.infoData?r.a.createElement("div",null,r.a.createElement(Ce.a,{className:t.list,subheader:r.a.createElement("li",null)},r.a.createElement("li",{key:"section-".concat(a.props.infoData["Facility ID"]),className:t.listSection},"{}"!=JSON.stringify(a.props.infoData)&&r.a.createElement("ul",{className:t.ul},Object.keys(a.getAdoptStatusByIndex(a.state.pageIndex).value).map(function(e){return"Salesforce Id"===e?r.a.createElement(Se.a,{key:"item-".concat(a.getAdoptStatusByIndex(a.state.pageIndex),"-").concat(e)},r.a.createElement(we.a,{href:a.props.sandboxRoot+"".concat(a.getAdoptStatusByIndex(a.state.pageIndex).value[e]),target:"_blank"},"Asset Link")):r.a.createElement(Se.a,{key:"item-".concat(a.getAdoptStatusByIndex(a.state.pageIndex),"-").concat(e)},r.a.createElement(xe.a,{primary:"".concat(e," : ").concat(a.getAdoptStatusByIndex(a.state.pageIndex).value[e])}))})))),r.a.createElement(I.a,{container:!0,direction:"column"},r.a.createElement(X.a,{variant:"extended","aria-label":"Delete",className:!1===a.getAdoptStatusByIndex(a.state.pageIndex).value.Adopted?t.orphanedButton:t.adoptedButton,onClick:this.toggleAdopt.bind(this)},r.a.createElement("b",null,!1===a.getAdoptStatusByIndex(a.state.pageIndex).value.Adopted?"Adopt":"Orphan")),r.a.createElement(X.a,{variant:"extended",className:t.chatterButton,onClick:this.getChatterFeed.bind(this)},r.a.createElement("b",null,"Chatter")))):null)))),"chatter"===this.props.panelUse&&r.a.createElement(te.a,{in:"chatter"===this.props.panelUse,timeout:1},r.a.createElement("div",null,r.a.createElement("div",{className:t.chatterHeader},r.a.createElement(I.a,{item:!0,xs:!0,className:t.chatterPostGrid},r.a.createElement(I.a,{container:!0,spacing:16,alignItems:"center",direction:"row"},r.a.createElement(I.a,{item:!0,xs:2},r.a.createElement(de.a,{className:t.button,onClick:function(){return a.addPost(a.state.chatterInfo[0].message.parentId)}},r.a.createElement(Je.a,{color:"primary"}))),r.a.createElement(I.a,{item:!0,xs:10},r.a.createElement(se.a,{id:"chatPostTextField",label:"Post to: "+JSON.stringify(a.getAdoptStatusByIndex(a.state.pageIndex).value["Facility ID"]),multiline:!0,rowsMax:"4",value:this.state.postText,onChange:a.postOnChange,className:t.textField,margin:"normal"}))))),r.a.createElement("div",{className:"body"},r.a.createElement(I.a,{container:!0,direction:"column",justify:"center",alignItems:"center"},a.state.chatterInfo?r.a.createElement(I.a,{container:!0,direction:"column",justify:"center",alignItems:"center"},r.a.createElement(Ce.a,{className:t.chatterList},r.a.createElement("li",{key:"section-".concat(a.props.infoData["Facility ID"])},"{}"!=JSON.stringify(a.props.infoData)&&r.a.createElement("ul",{className:t.ul},a.state.chatterInfo.map(function(n,o){return r.a.createElement(Se.a,{key:"item-".concat(o)},r.a.createElement(ne.a,{className:t.paper,elevation:1},r.a.createElement(I.a,{container:!0,spacing:16,alignItems:"center",direction:"row"},r.a.createElement(Ae.a,{src:n.actor.photo,className:t.avatar}),r.a.createElement(xe.a,null,r.a.createElement(we.a,{href:e.props.sandboxRoot+"".concat(n.actor.id)+"/view",target:"_blank"},n.actor.displayName))),r.a.createElement("p",null,n.message.text),r.a.createElement(I.a,{container:!0,spacing:16,alignItems:"center",direction:"row",className:t.commentGrid},r.a.createElement(I.a,{item:!0,xs:2},r.a.createElement(de.a,{className:t.button,onClick:function(){return a.addComment(n.message.id)}},r.a.createElement(Je.a,{color:"primary"}))),r.a.createElement(I.a,{item:!0,xs:10},r.a.createElement(se.a,{id:"standard-multiline-flexible",label:"Comment Text:",multiline:!0,rowsMax:"4",value:e.state.commentValues[n.message.id],name:e.state.commentValues[n.message.id],onChange:e.commentOnChange.bind(e,n.message.id),className:t.textField,margin:"normal"}))),n.message.comments.page.items.length>0&&r.a.createElement("div",null,r.a.createElement(Ne.a,null,r.a.createElement(Pe.a,{expandIcon:r.a.createElement(Ue.a,null)},r.a.createElement(_e.a,{className:t.heading},"Comments")),r.a.createElement(Le.a,null,r.a.createElement(Ce.a,{className:t.commentList},r.a.createElement("li",{key:"section-".concat(a.props.infoData["Facility ID"])},"{}"!=JSON.stringify(a.props.infoData)&&r.a.createElement("ul",{className:t.ul},n.message.comments.page.items.map(function(e,a){return r.a.createElement(Se.a,{key:"item-".concat(a)},r.a.createElement(ne.a,{className:t.paper,elevation:1},r.a.createElement(I.a,{container:!0,spacing:16,alignItems:"center",direction:"row"},r.a.createElement(Ae.a,{src:e.user.photo.smallPhotoUrl,className:t.avatar}),r.a.createElement(xe.a,null,r.a.createElement(we.a,{href:"https://carync--odin.lightning.force.com/lightning/r/User/"+"".concat(e.user.id)+"/view",target:"_blank"},e.user.displayName))),r.a.createElement("p",null,e.body.text)))})))))))))}))))):null))))))}}]),t}(n.Component)),qe=Object(ue.withStyles)(function(e){return{button:{margin:e.spacing.unit,pointerEvents:"auto"},list:{width:"100%",height:"100%",position:"relative",margin:0,paddingTop:5*e.spacing.unit},listSection:{height:"100%",backgroundColor:"inherit",listStyleType:"none",width:"100%"},link:{margin:e.spacing.unit},ul:{backgroundColor:"inherit",padding:0,margin:0},subHeader:{fontSize:"2rem",backgroundColor:"#E8E8E8"},pointerEventsAuto:{pointerEvents:"auto"},orphanedButton:{color:e.palette.getContrastText(z.a[500]),backgroundColor:z.a[500],maxWidth:25*e.spacing.unit,margin:.5*e.spacing.unit,"&:hover":{backgroundColor:z.a[700]}},adoptedButton:{color:e.palette.getContrastText(be.a[500]),backgroundColor:be.a[500],maxWidth:25*e.spacing.unit,margin:.5*e.spacing.unit,"&:hover":{backgroundColor:be.a[700]}},chatterButton:{color:e.palette.getContrastText(ve.a[500]),backgroundColor:ve.a[500],maxWidth:25*e.spacing.unit,margin:.5*e.spacing.unit,"&:hover":{backgroundColor:ve.a[700]}},chatterHeader:{height:15*e.spacing.unit},chatterList:{width:"100%",height:"100%",position:"relative",margin:0,paddingTop:e.spacing.unit},chatterPostGrid:{paddingTop:e.spacing.unit,paddingBottom:0,paddingRight:3*e.spacing.unit,marginTop:0,marginBottom:0,marginRight:3*e.spacing.unit},avatar:{margin:10},paper:{width:"100%",padding:e.spacing.unit},card:{minWidth:275},title:{fontSize:14},pos:{marginBottom:12},heading:{fontSize:e.typography.pxToRem(18),fontWeight:e.typography.fontWeightRegular},commentList:{width:"100%",height:"100%",position:"relative",margin:0,paddingTop:0},textField:{marginLeft:e.spacing.unit,marginRight:e.spacing.unit,width:"100%"},commentGrid:{paddingRight:3*e.spacing.unit}}})(Ge),Ye=a(217),We=a.n(Ye),ze=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){a.props.logUserOut()},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(e){var t=this.props.classes;return r.a.createElement("div",{className:t.parentDiv},r.a.createElement(X.a,{color:"primary","aria-label":"Add",className:t.fab,onClick:this.onClick},r.a.createElement(We.a,null)))}}]),t}(r.a.Component),Qe=(Object(ue.withStyles)(function(e){return{fab:{margin:e.spacing.unit,pointerEvents:"auto"}}})(ze),a(512),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).setProjectCallback=function(e){a.props.projectCallback(e)},a.setPhaseCallback=function(e){a.props.phaseCallback(e)},a.componentDidUpdate=function(){},a.state={hideSidePanel:!0},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"mapOverlayPanel"},r.a.createElement(I.a,{container:!0,spacing:0,alignItems:"center",direction:"row",justify:"center"},r.a.createElement(C,{view:this.props.view,resultPinDragable:!0}),r.a.createElement(qe,{infoData:this.props.infoData,adoptCallback:this.props.adoptCallback,panelUse:this.props.panelUse,panelUseChangeCallback:this.props.panelUseChangeCallback,nodeAppRoot:this.props.nodeAppRoot,sandboxRoot:this.props.sandboxRoot})))}}]),t}(n.Component)),He=(a(513),[{id:"stormInlets",label:"Storm Inlets",url:"https://maps.townofcary.org/arcgis/rest/services/OneCary/StormwaterCollectionSystem/MapServer/",serviceIndex:2,outFields:['"FACILITYID"','"INLETTYPE"','"ACCESSDIAM"','"ADOPTED"'],fields:[{name:"OBJECTID",alias:"Object ID",type:"oid"},{name:"FACILITYID",alias:"Facility ID",type:"string"},{name:"INLETTYPE",alias:"Inlet Type",type:"string"},{name:"ACCESSDIAM",alias:"Access Diameter",type:"double"},{name:"ADOPTED",alias:"Adopted",type:"string"},{name:"SFID",alias:"Salesforce Id",type:"string"}],fieldAliases:["Facility ID","Inlet Type","Access Diameter","Adopted"],popupTemplate:null,definitionExpression:"INLETTYPE='Pipe'",minScale:2257,renderer:{type:"simple",symbol:{type:"simple-marker",size:12,color:"red",outline:{width:.5,color:"white"}}},classrenderer:{type:"unique-value",field:"test",uniqueValueInfos:[{value:!0,symbol:{type:"simple-marker",size:12,color:"red",outline:{width:.5,color:"white"}}},{value:!0,symbol:{type:"simple-marker",size:12,color:"blue",outline:{width:.5,color:"white"}}}]}}]),Ke=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).loadMap=function(e){var t=Object(h.a)(e.loadedModules,4),n=t[0],r=t[1],o=t[2],i=t[3],s=e.containerNode,l=Object(g.a)(Object(g.a)(a)),c=new o({visible:!0,id:"selectedParcelGL"});l.setState({selectedParcelGL:c}),new r({container:s,center:[-78.78004,35.78961],zoom:18,map:new n({basemap:"satellite",id:"daMap"})}).when(function(e){e.id="myMapView",l.setState({mapView:e}),e.on("click",l.mapClick),e.popup.highlightEnabled=!1,e.popup.actions={},l.addFeatureLayers(e,function(){l.loadFeaturesByExtent(function(){"null"!=l.props.sessionParameters&&l.handleSessionParameters(l.props.sessionParameters)}),i.watch(e,"extent",l.debounce(function(){l.loadFeaturesByExtent()},150))})})},a.debounce=function(e,t,a){var n;return function(){var r=this,o=arguments,i=a&&!n;clearTimeout(n),n=setTimeout(function(){n=null,a||e.apply(r,o)},t),i&&e.apply(r,o)}},a.addFeatureLayers=function(e,t){var n=Object(g.a)(Object(g.a)(a));Object(y.loadModules)(["esri/layers/FeatureLayer"]).then(function(a){var r=Object(h.a)(a,1)[0];He.forEach(function(t){var a=new r({popupTemplate:t.popupTemplate,fields:t.fields,objectIdField:"OBJECTID",id:t.id,geometryType:"point",source:[],popupEnabled:!1});a.when(function(e){e.id=t.id;var a=n.state.layers.concat({featureLayerId:e.id,identifyable:!0});n.setState({layers:a})}),a.minScale=t.minScale;var o={type:"unique-value",valueExpression:' IIf($feature.ADOPTED=="true", true, false)',valueExpressionTitle:"Adoption Status",uniqueValueInfos:[{value:!0,symbol:n.createMarkerSymbol("#00ff00",12),label:"adopted"},{value:!1,symbol:n.createMarkerSymbol("#ff002e",12),label:"unadopted"}]};a.renderer=o,e.map.add(a),e.whenLayerView(a).then(function(e){var a=n.state.layerViews.concat({featureLayerId:t.id,layerView:e});n.setState({layerViews:a})})}),t()})},a.createMarkerSymbol=function(e,t){return{type:"simple-marker",color:e,angle:0,xoffset:0,yoffset:0,size:t,style:"circle",outline:{color:[0,0,0,51],width:.5}}},a.loadFeaturesByExtent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Object(g.a)(Object(g.a)(a));He.forEach(function(a){var n=t.state.mapView.map.findLayerById(a.id),r=t.state.mapView.extent,o="https://maps.townofcary.org/arcgis/rest/services/OneCary/StormwaterCollectionSystem/MapServer/2/query?where="+a.definitionExpression+"&outFields=*&geometry="+JSON.stringify(r)+"&outSR=4326&geometryType=esriGeometryEnvelope&spatialRel=esriSpatialRelIntersects&outFields=&f=pjson";m.a.get(o).then(function(a){var r=[],o=JSON.parse(JSON.stringify(a.data.features));o.forEach(function(e){r.push(e.attributes.FACILITYID),e.geometry.type="point"});var i=r.slice(),s=r.slice(),l={where:"FACILITYID IN ('"+i.join("','")+"')",returnGeometry:!1,outFields:["FACILITYID"]};t.queryFeatureLayer(n,l).then(function(a){a.forEach(function(e){r.indexOf(e.attributes.FACILITYID)>-1&&i.splice(i.indexOf(e.attributes.FACILITYID),1)}),i.length>0&&m()({method:"post",url:t.props.nodeAppRoot+"getassets/",data:{assetids:i}}).then(function(a){var r=JSON.parse(JSON.stringify(a.data)),i=[];o.forEach(function(e){e.attributes.ADOPTED="false";for(var t=0;t<r.length;t++){var a=r[t];if(e.attributes.FACILITYID===a.SerialNumber){e.attributes.ADOPTED=1==a.Adopted__c?"true":"false",console.log("record.Id: "+a.Id),e.attributes.SFID=a.Id,i.push(e);break}}}),n.applyEdits({addFeatures:i}).then(function(){n.queryFeatures().then(function(a){var r={where:"NOT FACILITYID IN ('"+s.join("','")+"')",returnGeometry:!0,outFields:["*"]};t.queryFeatureLayer(n,r).then(function(t){var a=[];t.forEach(function(e){e.geometry.type="point",a.push(e)}),a.length>0&&n.applyEdits({deleteFeatures:a}).then(function(){n.queryFeatureCount().then(function(e){})}).catch(function(e){console.log("error: "+e)}),e?e():console.log("noCallback")})})})})})}).catch(function(e){console.log("error: "+e)})})},a.handleSessionParameters=function(e){var t=JSON.parse(e),n=Object(g.a)(Object(g.a)(a));if("query"===t.type){var r=n.state.mapView.map.findLayerById(t.layerId),o={where:t.where,returnGeometry:!0,outFields:["*"]};n.queryFeatureLayer(r,o).then(function(e){var a={};e.forEach(function(e){var r=JSON.parse(JSON.stringify(e));a[r.attributes.OBJECTID+"_"+t.layerId]={},n.getLayerConfig(t.layerId).fields.forEach(function(e){"OBJECTID"!=e.name&&("ADOPTED"===e.name?a[r.attributes.OBJECTID+"_"+t.layerId][e.alias]="true"===r.attributes[e.name]:a[r.attributes.OBJECTID+"_"+t.layerId][e.alias]=r.attributes[e.name])})});var r=e[0];r.symbol={type:"simple-marker",color:[226,119,40,0],size:15,style:"square",outline:{color:[0,255,255],width:2}},n.state.mapView.goTo(r.geometry,{animate:!0,duration:1e3}),n.updateFeatureSelectionGraphic(r),n.setState({infoData:a})}).catch(function(e){console.log("error: "+e)})}},a.queryFeatureLayer=function(e,t){Object(g.a)(Object(g.a)(a));return Object(y.loadModules)(["esri/tasks/support/Query"]).then(function(a){var n=new(0,Object(h.a)(a,1)[0])(t);return e.queryFeatures(n).then(function(e){return e.features}).catch(function(e){console.error("queryFeatureLayers: "+e)})})},a.mapClick=function(e){a.panelUseChange("info"),a.spatiallyQueryLayers(e.mapPoint)},a.spatiallyQueryLayers=function(e){var t=Object(g.a)(Object(g.a)(a));Object(y.loadModules)(["esri/tasks/QueryTask","esri/tasks/support/Query"]).then(function(a){var n=Object(h.a)(a,2);n[0],n[1];t.state.layers.forEach(function(a){if(a.identifyable){var n=a.featureLayerId,r=t.state.mapView.map.findLayerById(n).createQuery();r.geometry=e,r.distance=10,r.unit="feet",r.spatialRelationship="intersects",r.outFields=["OBJECTID","FACILITYID","INLETTYPE","ACCESSDIAM","ADOPTED","SFID"];var o={type:"simple-marker",color:[226,119,40,0],size:15,style:"square",outline:{color:[0,255,255],width:2}},i=t.getLayerViewByLayerId(a.featureLayerId),s={};i.queryFeatures(r).then(function(e){if(e.hasOwnProperty("features"))if(e.features.length>0){e.features.forEach(function(e){var a=JSON.parse(JSON.stringify(e));s[a.attributes.OBJECTID+"_"+n]={},t.getLayerConfig(n).fields.forEach(function(e){"OBJECTID"!=e.name&&("ADOPTED"===e.name?s[a.attributes.OBJECTID+"_"+n][e.alias]="true"===a.attributes[e.name]:s[a.attributes.OBJECTID+"_"+n][e.alias]=a.attributes[e.name])})});var a=e.features[0];a.symbol=o,t.updateFeatureSelectionGraphic(a),t.setState({infoData:s})}else t.setState({infoData:null}),t.state.mapView.graphics.removeAll()}).catch(function(e){console.error(e)})}})}).catch(function(e){console.error(e)})},a.updateFeatureSelectionGraphic=function(e){a.state.mapView.graphics.removeAll(),a.state.mapView.graphics.add(e)},a.getLayerViewByLayerId=function(e){Object(g.a)(Object(g.a)(a));for(var t=a.state.layerViews,n=null,r=0;r<t.length;r++)if(t[r].featureLayerId==e){n=t[r].layerView;break}return n},a.getLayerConfig=function(e){for(var t,a=0;a<He.length;a++){var n=He[a];if(n.id===e){t=n;break}}return t},a.getFacilityIds=function(e){var t=[];return JSON.parse(JSON.stringify(e)).forEach(function(e){t.push(e.attributes["Facility ID"])}),t},a.deleteObjectKeys=function(e,t){t.forEach(function(t){delete e[t]})},a.adoptCallback=function(e){var t=Object(g.a)(Object(g.a)(a));Object(y.loadModules)(["esri/tasks/QueryTask","esri/tasks/support/Query"]).then(function(a){var n=Object(h.a)(a,2),r=(n[0],n[1],t.state.mapView.map),o=e[Object.keys(e)[0]].split("_")[1],i=e.value["Facility ID"],s=r.findLayerById(o),l=s.createQuery();l.where="FACILITYID = '"+i+"'",l.returnGeometry=!1,l.outFields=["OBJECTID","FACILITYID","INLETTYPE","ACCESSDIAM","ADOPTED","SFID"],t.getLayerViewByLayerId(o).queryFeatures(l).then(function(t){var a=JSON.parse(JSON.stringify(t.features[0]));a.attributes.ADOPTED=1==e.value.Adopted?"true":"false",s.applyEdits({updateFeatures:[a]}).then(function(e){s.queryFeatures().then(function(e){})})}).catch(function(e){console.error(e)})})},a.panelUseChange=function(e){a.setState({panelUse:e})},a.state={ctrlKey:!1,parametersLoaded:!1,mapView:null,layers:[],layerViews:[],infoData:null,panelUse:"info"},a.mapClick=a.mapClick.bind(Object(g.a)(Object(g.a)(a))),a.loadMap=a.loadMap.bind(Object(g.a)(Object(g.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",{className:"ReactMap"},r.a.createElement(f.a,{options:{url:"https://js.arcgis.com/4.10/"},modulesToLoad:["esri/Map","esri/views/MapView","esri/layers/GraphicsLayer","esri/core/watchUtils"],onReady:this.loadMap}),r.a.createElement(Qe,{adoptCallback:this.adoptCallback,infoData:this.state.infoData,panelUse:this.state.panelUse,panelUseChangeCallback:this.panelUseChange,nodeAppRoot:this.props.nodeAppRoot,sandboxRoot:this.props.sandboxRoot}))}}]),t}(r.a.PureComponent),Xe="https://woesoflightning.com/esri_salesforce_api/",$e="https://carync--zeus.lightning.force.com/",Ze=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={sessionTokenObj:null,sessionParameters:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this,t=new URLSearchParams(window.location.search);console.log("urlParams: "+t);var a=t.get("code");if(console.log("code: "+a),null===a){m()({method:"post",url:"https://woesoflightning.com/esri_salesforce_api/getclientid/"}).then(function(e){window.location=$e+"services/oauth2/authorize?response_type=code&client_id="+e.data+"&redirect_uri=https://woesoflightning.com&state="+t.get("state")})}else{e.setState({sessionParameters:t.get("state")}),m()({method:"post",url:Xe+"settoken/",data:{code:a}}).then(function(t){e.setState({sessionTokenObj:t.data.data})}).catch(function(e){})}}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(Ke,{nodeAppRoot:Xe,sessionParameters:this.state.sessionParameters,sandboxRoot:$e}))}}]),t}(n.Component);a(514);i.a.render(r.a.createElement(Ze,null),document.getElementById("root"))}},[[218,1,2]]]);
//# sourceMappingURL=main.9c920fcf.chunk.js.map